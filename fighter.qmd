---
title: "Final Project"
author: "Yifei Yang, Yiming Yuan"
format: pdf
---


```{r read-data, message=F, warning = F, echo=F}

library(skimr)
library(ggplot2)
library(dplyr)
library(readr)
library(MASS)
library(kableExtra)
ufc <- read_csv("data/ufc-fighters-statistics.csv")

# new variables 
ufc$win_ratio <- ufc$wins / (ufc$wins + ufc$losses + ufc$draws)
ufc$age <- as.integer(format(Sys.Date(), "%Y")) - as.integer(format(ufc$date_of_birth, "%Y"))

```

## Introduction and data


Around 300 million individuals worldwide identify themselves as fans of Mixed Martial Arts (MMA), with its popularity peaking in nations such as the United States, the United Kingdom, Brazil, Singapore, and China. The Ultimate Fighting Championship (UFC) is the premier organization in the MMA world. In the dynamic landscape of MMA, quantifying fighter performance is essential for both athletes and analysts. Our objective is to reveal the significance and implications of that factors that contribute to the fighters' performance. **The research questions is in what ways can MMA fighters improve their performance?**

Today's data comes from UFC fighter statistics collected in 2024, encompassing various dimensions of fighter performance results and parameters. **wins**, **losses** and **draws** represent the number of a fighter's victories, dogfalls and failures throughout their career. **height_cm**, **weight_in_kg** and **reach_in_cm** quantifies fighters physical attributes. **stance** is a categorical variable including Orthodox/Southpaw/Switch, which highlights fighters' preferred combat orientation. Performance metrics such as **significant_strikes_landed_per_minute** and **significant_striking_accuracy** record fighters' precision, timing, and offensive capabilities, while **significant_strikes_absorbed_per_minute** and **significant_strike_defence** quantify their defensive skills. **takedown_accuracy** and **average_takedowns_landed_per_15_minutes** assess fighters' proficiency in executing takedowns, while **takedown_defense** shows their ability to counter opponents' takedown attempts. Lastly, **average_submissions_attempted_per_15_minutes** measures fighters' inclination towards submission-based tactics, reflecting their grappling proficiency.

We add two new variables: **win_ratio** is calculated as the ratio of wins to the sum of wins, draws, and losses, offering a measure of a fighter's success rate; and **age** is derived from fighters' date_of_birth statistics, providing insight into the fighters' maturity and experience within the competitive landscape.

Figure 1. visualizes the distribution of fighters' striking and takedowns metrics.

```{r ch-1, message = F, warning = F, echo=F}

columns_to_plot <- c('average_takedowns_landed_per_15_minutes', 
                     'significant_striking_accuracy',
                     'significant_strikes_landed_per_minute', 
                     'significant_strikes_absorbed_per_minute',
                     'significant_strike_defence')
library(reshape2)
# Melt the data
melted_ufc <- melt(ufc[, columns_to_plot], 
                   variable.name = 'Statistic', 
                   value.name = 'Value')


p <- ggplot(melted_ufc, aes(x = Statistic, y = Value, fill = Statistic)) +
  geom_boxplot() +
  scale_fill_brewer(palette = "Paired") + # This uses color brewer palettes for fill colors
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4),
        plot.title = element_text(size = 10)) + 
  labs(x = 'Performance Statistic', 
       y = 'Value')

print(p)
```
**Figure 1. Box Plots of Fighting Statistics**


**sources:**

https://www.kaggle.com/datasets/aaronfriasr/ufc-fighters-statistics?resource=download

https://www.euronews.com/business/2023/09/27/the-booming-billion-dollar-business-of-combat-sports

## Methodology

**Predictor selection:** We utilized a heatmap to visually explore and identify the variables most closely associated with fighters' win_ratio. The heatmap allowed us to observe the strength and patterns of correlation between various predictors and the wins_ratio. Hence, we selected 7 predictors that demonstrated the highest correlation coefficients with the win_ratio for inclusion in the model, and they are Age,Stance,Average_takendowns_landed_per_15_minutes, Significant_striking_accuracy, Significant_strikes_landed_per_minute, Significant_strikes_absorbed_per_minute, Significant_strike_defence.


```{r ch-2,message = F, warning = F, echo=F}

selected_columns <- ufc %>%
  dplyr::select(age, height_cm, weight_in_kg, reach_in_cm, significant_strikes_landed_per_minute,
         significant_striking_accuracy, significant_strikes_absorbed_per_minute,
         significant_strike_defence, average_takedowns_landed_per_15_minutes,
         takedown_accuracy, takedown_defense, average_submissions_attempted_per_15_minutes, win_ratio)

# Compute the correlation matrix
correlation_matrix <- cor(selected_columns, use = "complete.obs")  # Handles NA by excluding

# Convert the correlation matrix to a long format for ggplot
correlation_data <- as.data.frame(as.table(correlation_matrix))

# Rename columns for clarity
names(correlation_data) <- c("variable1", "variable2", "value")

# Plotting the heatmap with correlation coefficients
ggplot(correlation_data, aes(x = variable1, y = variable2, fill = value)) +
  geom_tile() +  # This creates the heatmap tiles
  geom_text(aes(label = sprintf("%.2f", value)), color = "black", size = 1.5) +  # Adds text labels
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1), space = "Lab", name="Correlation") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4),
        axis.text.y = element_text(angle = 45, vjust = 1, size = 4),
        plot.title = element_text(size = 8)) + 
  labs( x = "", y = "", size = 2.5)

```
**Figure 2. Heatmap of Specified Variables**



**Ordinal regression model selection:** The data were fit by the ordinal logistic regression model based on model fit parameters (AIC: 3586.268) to explore the relationships between fighters' characteristics. Specifically, the response variable win_ratio is categorized into 0-0.33, 0.33-0.67, and 0.67-1, and labelled as "Low", "Medium", "High" respectively. Our analysis explore the relationships between fighters' win_ratio groups (Low, Medium, and High) and a set of predictors.

According to **Table1**, the confusion matrix shows the distribution of actual versus predicted group memberships, which ndicates that the test accuracy of this ordinal model is approximately 71%. Thus, the ordinal model can make more accurate predictions and it is feasible to find more influential predictor by ordinal model.

```{r ch-3, message = F, warning = F, echo = F}
#ordinal classified by win_ratio

ufc$win_ratio_group <- cut(ufc$win_ratio,
                                breaks = c(0, 0.33, 0.66, 1),
                                labels = c("Low", "Medium", "High"),
                                include.lowest = TRUE)
ufc$win_ratio_group <- ordered(ufc$win_ratio_group)

model4 <- polr(win_ratio_group ~ age + stance + average_takedowns_landed_per_15_minutes + 
                      significant_striking_accuracy + significant_strikes_landed_per_minute + 
                      significant_strikes_absorbed_per_minute + significant_strike_defence,
               data = ufc)


```

```{r ch-4, message = F, warning = F, echo = F}
#prediction accuracy
library(MASS) 
library(caret) 

ufc$predicted <- predict(model4, newdata = ufc, type = "class")

# Creating a confusion matrix
conf_matrix <- table(Actual = ufc$win_ratio_group, Predicted = ufc$predicted)


# Calculating the accuracy from the confusion matrix
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)



```

**Table1. Confusion Matrix and Accuracy from the Ordinal Model**

|               |        | **Predicted** |        |                 |
|--------------:|-------:|:--------------|-------:|----------------:|
|               |        | Low           | Medium |            High |
|    **Actual** |    Low | 2             |     47 |               7 |
|               | Medium | 0             |    251 |             620 |
|               |   High | 0             |    191 |            1858 |
| **Accuracy:** |        |               |        | 0.7093413978495 |

## Results



**Table2. Characteristics of UFC Fighters with Ordinal Model**

```{r ch-5, message = F, warning = F, echo = F}
# Extract summary of the model
summary_model <- summary(model4)


coefficients <- summary_model$coefficients
odds_ratios <- exp(coefficients[, 1])

# Create a data frame for coefficients and standard errors
coefficients_table <- data.frame(
  Coefficients = coefficients[, 1],
  'OR' = odds_ratios,
  'SD Error' = coefficients[, 2],
  't-value' = coefficients[, 3]
)
kable(coefficients_table, digits = 4)

```
Results from our ordinal regression model are presented in **Table2**. Age reported a negative coefficient (-0.115), indicating that for each one-unit increase in age, a fighter has approximately 0.8912 times the odds of being in a higher category of win ratio compared to younger fighters, assuming all other variables are held constant. Average takedowns landed per 15 minutes has a positive coefficient (0.155), suggesting that a fighter will have approximately 1.1681 times the odds of being in a higher category of win ratio, if he increases one unit in average takedowns landed per 15 minutes. Significant strike defence shows a negligible negative coefficient (-0.0007179), which is not evident to prove that it has significant effect on win ratio groups.


The Sideways stance has a significantly positive coefficient (coef = 4.3460381), while the coefficients for other stances are all negative. However, since the absolute t-values of all stance types are less than 1.96, there is no strong evidence to reject the null hypothesis that the stance does not have significantly effect on win ratio groups.

Therefore, the factors which have statistically significant effect on win ratio groups are age, average_takedowns_landed_per_15_minutes, significant_striking_accuracy, significant_strikes_landed_per_minute, and significant_strikes_absorbed_per_minute.

## Discussion

In this section, we focus on the factors that have have statistically significant effect on win ratio groups and  examine how fighters strategize and adapt in response to these factors to enhance their overall performance. First of all, we suggest that fighters can prioritize takedown techniques during training sessions, focusing on both offensive and defensive aspects. They may develop game plans that emphasize takedowns as a means of controlling the pace of the fight and scoring points. Additionally, striking number and accuracy is predicted to be crucial to performance improvement. Applying combinations of strikes rather than single shots can potentially increase the effectiveness. Coaches may develop strategies that encourage fighters to engage in striking exchanges at opportune moments, such as when opponents are off-balance. Lastly, to reduce the number of punches absorbed, a fighter can incorporate drills focused on head movement, blocking, and evasive footwork. They can also employ clinch work or positional control to mitigate damage, allowing for brief periods of rest and recovery between striking engagements.


As for limitations, since we only categorize the wins ratio into three groups, this may simplify the prediction task and potentially lose granularity in the data, which affects the model's ability to accurately predict the win ratios. We also observe that, for example, missing values (NA) in variables such as significant_strike_defence have been treated as zeros, which could potentially stem from errors in the original data. This limitation may have contributed to inaccuracies in the model results. In addition, the ordinal model may oversimplify the complex dynamics of MMA fights and fail to capture all relevant predictors. 

For future analyses, we need to develop more robust strategies for handling missing data, such as multiple imputation or predictive modeling, to preserve the integrity of the dataset. Additional variables such as fighters' training regimens, injury history, and psychological factors should be incorporated to better learn about the performance outcomes. Instead of simply categorizing win ratios into just three groups, we should consider using a more granular approach with additional categories.  


