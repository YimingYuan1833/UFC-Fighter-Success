---
title: "Final Project"
author: "Yifei Yang, Yiming Yuan"
format: pdf
---

## Read in the data

```{r read-data, message=FALSE}

library(skimr)

library(ggplot2)
library(dplyr)

library(readr)

library(MASS)

ufc <- read_csv("data/ufc-fighters-statistics.csv")

```

## Introduction and data
Around 300 million individuals worldwide identify themselves as fans of Mixed Martial Arts (MMA), with its popularity peaking in nations such as the United States, the United Kingdom, Brazil, Singapore, and China. The Ultimate Fighting Championship (UFC) is the premier organization in the MMA world. Our motivation is to research on what contributes to the fighters' performance. Thus, the research questions are: How largely do the innate physical attributes affect fighters' performance? What's the most effective stance? How does the way fighters stroke (speed/accuracy/amount/defence success) influence their performance? 可加其他问题

Today's data are UFC fighter statistics including:

**wins:** The number of wins the fighter has in their career.

**draws:** The number of draws the fighter has in their career.

**height_cm:** The height of the fighter in centimeters.

**weight_in_kg:** The weight of the fighter in kilograms.

**reach_in_cm:** The reach of the fighter in centimeters.

**stance:** The fighting stance of the fighter (Orthodox/Southpaw/Switch).

**significant_strikes_landed_per_minute:** The average number of significant strikes landed by the fighter per minute.

**significant_striking_accuracy:** The percentage of significant strikes that land successfully for the fighter.

**significant_strikes_absorbed_per_minute:** The average number of significant strikes absorbed by the fighter per minute.

**significant_strike_defence:** The percentage of opponent's significant strikes that the fighter successfully defends.

**average_takedowns_landed_per_15_minutes:** The average number of takedowns landed by the fighter per 15 minutes.

**takedown_accuracy:** The percentage of takedown attempts that are successful for the fighter.

**takedown_defense:** The percentage of opponent's takedown attempts that the fighter successfully defends.

**average_submissions_attempted_per_15_minutes:** The average number of submission attempts made by the fighter per 15 minutes.

Our response variable is wins, predictors are 

sources:

https://www.kaggle.com/datasets/aaronfriasr/ufc-fighters-statistics?resource=download

https://www.euronews.com/business/2023/09/27/the-booming-billion-dollar-business-of-combat-sports

**EDA**

```{r ch-1, message - F}
library(ggplot2)

plot <- ggplot(ufc, aes(x = wins)) +
        geom_histogram(binwidth = 1, fill = "skyblue", color = "white") +
        geom_density(alpha = 0.5, fill = "skyblue") +
        labs(x = "Number of Wins", y = "Frequency/Density",
             title = "Distribution of Wins in Fighter Careers") +
        theme_minimal() +
        theme(panel.grid = element_blank())  

print(plot)


plot_height <- ggplot(ufc, aes(x = height_cm, y = wins)) +
               geom_point(color = "blue") +
               labs(x = "Height (cm)", y = "Wins", 
                    title = "Relationship between Height and Wins")

print(plot_height)

plot_weight <- ggplot(ufc, aes(x = weight_in_kg, y = wins)) +
               geom_point(color = "green") +
               labs(x = "Height (cm)", y = "Wins", 
                    title = "Relationship between Height and Wins")

print(plot_weight)

plot_reach <- ggplot(ufc, aes(x = reach_in_cm, y = wins)) +
              geom_point(color = "red") +
              labs(x = "Reach (cm)", y = "Wins", 
                   title = "Relationship between Reach and Wins")
print(plot_reach)

```
## Data Preparation

```{r ch-2, message - F}

ufc$win_ratio <- ufc$wins / (ufc$wins + ufc$losses + ufc$draws)
ufc$age <- as.integer(format(Sys.Date(), "%Y")) - as.integer(format(ufc$date_of_birth, "%Y"))

print(head(ufc))

skim(ufc)

```
## Choose Predictors

```{r ch-3, message - F}

selected_columns <- ufc %>%
  dplyr::select(age, height_cm, weight_in_kg, reach_in_cm, significant_strikes_landed_per_minute,
         significant_striking_accuracy, significant_strikes_absorbed_per_minute,
         significant_strike_defence, average_takedowns_landed_per_15_minutes,
         takedown_accuracy, takedown_defense, average_submissions_attempted_per_15_minutes, win_ratio)

# Compute the correlation matrix
correlation_matrix <- cor(selected_columns, use = "complete.obs")  # Handles NA by excluding

# Convert the correlation matrix to a long format for ggplot
correlation_data <- as.data.frame(as.table(correlation_matrix))

# Rename columns for clarity
names(correlation_data) <- c("variable1", "variable2", "value")

# Plotting the heatmap with correlation coefficients
ggplot(correlation_data, aes(x = variable1, y = variable2, fill = value)) +
  geom_tile() +  # This creates the heatmap tiles
  geom_text(aes(label = sprintf("%.2f", value)), color = "black", size = 3) +  # Adds text labels
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1), space = "Lab", name="Correlation") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        axis.text.y = element_text(angle = 45, vjust = 1)) +  # Adjust text alignment if necessary
  labs(title = "Heatmap of Specified Continuous Variables", x = "", y = "")

```

Predictors:
age
Stance (category)
average_takendowns_landed_per_15 minutes
Significant_striking_accuracy
Significant_strikes_landed per_minute
significant_strikes_absorbed_per_minute
significant_strike_defence

## Model Fitting

```{r ch-4, message - F}
#linear
ufc$stance <- as.factor(ufc$stance)

model1 <- lm(win_ratio ~ age + stance + average_takedowns_landed_per_15_minutes + significant_striking_accuracy +
            significant_strikes_landed_per_minute + significant_strikes_absorbed_per_minute + significant_strike_defence, 
            data = ufc)


summary(model1)

```
**Categorical variable:**

0.0435211 represents the difference in average win ratio for fighters with Orthodox stance, compared with fighters with Open stance, while holding the other predictors constant.

-0.0893852 represents the difference in average win ratio for fighters with Sideways stance, compared with fighters with Open stance, while holding the other predictors constant.

0.0484787 represents the difference in average win ratio for fighters with Southpaw stance, compared with fighters with Open stance, while holding the other predictors constant.

0.0895293 represents the difference in average win ratio for fighters with Switch stance, compared with fighters with Open stance, while holding the other predictors constant.

We notice that the p-value for Stance variables are all less than 0.05, and thus, there is insufficient evidence to suggest a linear relationship between fighter's stance and wins ratio at 0.05 significance level, while controlling for other predictors 



**Continuous variable:**

While holding the other predictors constant, when the average number of takedowns landed by the fighter per 15 minutes increases by 1 time, the average win ratio of the fighter will increase by 0.0113384.

While holding the other predictors constant, when the significant striking accuracy increases by 1%, the average win ratio of the fighter will increase by 0.0017843.

While holding the other predictors constant, when the average number of significant strikes landed by the fighter per minute increases by 1 time, the average win ratio of the fighter will increase by 0.0199915.

While holding the other predictors constant, when the average number of significant strikes absorbed by the fighter per minute increases by 1 time, the average win ratio of the fighter will decrease by 0.0016777.

While holding the other predictors constant, when the opponent's significant strikes that the fighter successfully defends increases by 1%, the average win ratio of the fighter will increase by 0.0009887.



```{r ch-5, message - F}
#logistic
ufc$win_ratio_binary <- ifelse(ufc$win_ratio > 0.5, 1, 0)

model2 <- glm(win_ratio_binary ~ age + stance + average_takedowns_landed_per_15_minutes + 
                      significant_striking_accuracy + significant_strikes_landed_per_minute + 
                      significant_strikes_absorbed_per_minute + significant_strike_defence, 
                      family = binomial, data = ufc)

summary(model2)
```
We impose a threshold of 0.5 for wins ration: when it's larger than 0.5, we consider it Satisfactory Performance, and when it's less than 0.5, we consider it Unsatisfactory Performance. 

```{r ch-6, message - F}
#ordinal classified by age

ufc$win_ratio_group <- cut(ufc$win_ratio,
                                breaks = c(0, 0.33, 0.66, 1),
                                labels = c("Low", "Medium", "High"),
                                include.lowest = TRUE)
ufc$win_ratio_group <- ordered(ufc$win_ratio_group)

model3 <- polr(win_ratio_group ~ age + stance + average_takedowns_landed_per_15_minutes + 
                      significant_striking_accuracy + significant_strikes_landed_per_minute + 
                      significant_strikes_absorbed_per_minute + significant_strike_defence,
               data = ufc)
summary(model3)

```
