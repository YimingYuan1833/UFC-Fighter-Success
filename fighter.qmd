---
title: "Final Project"
author: "Yifei Yang, Yiming Yuan"
format: pdf
---

## Read in the data

```{r read-data, message=FALSE}

library(skimr)
library(ggplot2)
library(dplyr)
library(readr)
library(MASS)


ufc <- read_csv("data/ufc-fighters-statistics.csv")

```

## Introduction and data
Around 300 million individuals worldwide identify themselves as fans of Mixed Martial Arts (MMA), with its popularity peaking in nations such as the United States, the United Kingdom, Brazil, Singapore, and China. The Ultimate Fighting Championship (UFC) is the premier organization in the MMA world. Our motivation is to research on what contributes to the fighters' performance. Thus, the research questions is: Which model we consider effective in predicting fighters' winning ratio? How fighters improve their performance?

Today's data are UFC fighter statistics including:

**wins:** The number of wins the fighter has in their career.

**draws:** The number of draws the fighter has in their career.

**height_cm:** The height of the fighter in centimeters.

**weight_in_kg:** The weight of the fighter in kilograms.

**reach_in_cm:** The reach of the fighter in centimeters.

**stance:** The fighting stance of the fighter (Orthodox/Southpaw/Switch).

**significant_strikes_landed_per_minute:** The average number of significant strikes landed by the fighter per minute.

**significant_striking_accuracy:** The percentage of significant strikes that land successfully for the fighter.

**significant_strikes_absorbed_per_minute:** The average number of significant strikes absorbed by the fighter per minute.

**significant_strike_defence:** The percentage of opponent's significant strikes that the fighter successfully defends.

**average_takedowns_landed_per_15_minutes:** The average number of takedowns landed by the fighter per 15 minutes.

**takedown_accuracy:** The percentage of takedown attempts that are successful for the fighter.

**takedown_defense:** The percentage of opponent's takedown attempts that the fighter successfully defends.

**average_submissions_attempted_per_15_minutes:** The average number of submission attempts made by the fighter per 15 minutes.

Our response variable is wins, predictors are 

sources:

https://www.kaggle.com/datasets/aaronfriasr/ufc-fighters-statistics?resource=download

https://www.euronews.com/business/2023/09/27/the-booming-billion-dollar-business-of-combat-sports


## Data Preparation

```{r ch-1, message = F, warning = F, echo=F}

ufc$win_ratio <- ufc$wins / (ufc$wins + ufc$losses + ufc$draws)
ufc$age <- as.integer(format(Sys.Date(), "%Y")) - as.integer(format(ufc$date_of_birth, "%Y"))

print(head(ufc))

skim(ufc)

```
## Choose Predictors

```{r ch-2,message = F, warning = F, echo=F}

selected_columns <- ufc %>%
  dplyr::select(age, height_cm, weight_in_kg, reach_in_cm, significant_strikes_landed_per_minute,
         significant_striking_accuracy, significant_strikes_absorbed_per_minute,
         significant_strike_defence, average_takedowns_landed_per_15_minutes,
         takedown_accuracy, takedown_defense, average_submissions_attempted_per_15_minutes, win_ratio)

# Compute the correlation matrix
correlation_matrix <- cor(selected_columns, use = "complete.obs")  # Handles NA by excluding

# Convert the correlation matrix to a long format for ggplot
correlation_data <- as.data.frame(as.table(correlation_matrix))

# Rename columns for clarity
names(correlation_data) <- c("variable1", "variable2", "value")

# Plotting the heatmap with correlation coefficients
ggplot(correlation_data, aes(x = variable1, y = variable2, fill = value)) +
  geom_tile() +  # This creates the heatmap tiles
  geom_text(aes(label = sprintf("%.2f", value)), color = "black", size = 1.5) +  # Adds text labels
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1), space = "Lab", name="Correlation") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 3),
        axis.text.y = element_text(angle = 45, vjust = 1, size = 3),
        plot.title = element_text(size = 8)) + 
  labs(title = "Heatmap of Specified Variables", x = "", y = "", size = 2.5)

```

Predictors:
age
Stance (category)
average_takendowns_landed_per_15_minutes
Significant_striking_accuracy
Significant_strikes_landed_per_minute
significant_strikes_absorbed_per_minute
significant_strike_defence

**EDA**

```{r ch-3, message = F, warning = F, echo=F}

columns_to_plot <- c('average_takedowns_landed_per_15_minutes', 
                     'significant_striking_accuracy',
                     'significant_strikes_landed_per_minute', 
                     'significant_strikes_absorbed_per_minute',
                     'significant_strike_defence')
library(reshape2)
# Melt the data
melted_ufc <- melt(ufc[, columns_to_plot], 
                   variable.name = 'Statistic', 
                   value.name = 'Value')


p <- ggplot(melted_ufc, aes(x = Statistic, y = Value, fill = Statistic)) +
  geom_boxplot() +
  scale_fill_brewer(palette = "Paired") + # This uses color brewer palettes for fill colors
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4),
        plot.title = element_text(size = 10)) + 
  labs(title = 'Colorful Box Plots of Fighting Statistics', 
       x = 'Statistic', 
       y = 'Value')

# Print the plot
print(p)
```

## Model Fitting

```{r ch-4, message = F, warning = F, echo=F}
#linear
ufc$stance <- as.factor(ufc$stance)

model1 <- lm(win_ratio ~ age + stance + average_takedowns_landed_per_15_minutes + significant_striking_accuracy +
            significant_strikes_landed_per_minute + significant_strikes_absorbed_per_minute + significant_strike_defence, 
            data = ufc)


summary(model1)

```
**Categorical variable:**

0.0435211 represents the difference in average win ratio for fighters with Orthodox stance, compared with fighters with Open stance, while holding the other predictors constant.

-0.0893852 represents the difference in average win ratio for fighters with Sideways stance, compared with fighters with Open stance, while holding the other predictors constant.

0.0484787 represents the difference in average win ratio for fighters with Southpaw stance, compared with fighters with Open stance, while holding the other predictors constant.

0.0895293 represents the difference in average win ratio for fighters with Switch stance, compared with fighters with Open stance, while holding the other predictors constant.

We notice that the p-value for Stance variables are all less than 0.05, and thus, there is insufficient evidence to suggest a linear relationship between fighter's stance and wins ratio at 0.05 significance level, while controlling for other predictors 



**Continuous variable:**

While holding the other predictors constant, when the average number of takedowns landed by the fighter per 15 minutes increases by 1 time, the average win ratio of the fighter will increase by 0.0113384.

While holding the other predictors constant, when the significant striking accuracy increases by 1%, the average win ratio of the fighter will increase by 0.0017843.

While holding the other predictors constant, when the average number of significant strikes landed by the fighter per minute increases by 1 time, the average win ratio of the fighter will increase by 0.0199915.

While holding the other predictors constant, when the average number of significant strikes absorbed by the fighter per minute increases by 1 time, the average win ratio of the fighter will decrease by 0.0016777.

While holding the other predictors constant, when the opponent's significant strikes that the fighter successfully defends increases by 1%, the average win ratio of the fighter will increase by 0.0009887.



```{r ch-5, message = F, warning = F, echo = F}
#ordinal classified by win

ufc$win_ratio_group <- cut(ufc$win_ratio,
                                breaks = c(0, 0.33, 0.66, 1),
                                labels = c("Low", "Medium", "High"),
                                include.lowest = TRUE)
ufc$win_ratio_group <- ordered(ufc$win_ratio_group)

model4 <- polr(win_ratio_group ~ age + stance + average_takedowns_landed_per_15_minutes + 
                      significant_striking_accuracy + significant_strikes_landed_per_minute + 
                      significant_strikes_absorbed_per_minute + significant_strike_defence,
               data = ufc)
summary(model4)

```
```{r ch-6, message = F, warning = F, echo = F}
#prediction accuracy
library(MASS) 
library(caret) 

ufc$predicted <- predict(model4, newdata = ufc, type = "class")

# Creating a confusion matrix
conf_matrix <- table(Actual = ufc$win_ratio_group, Predicted = ufc$predicted)
print(conf_matrix)

# Calculating the accuracy from the confusion matrix
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
print(paste("Accuracy: ", accuracy))


```

```{r ch-7, message = F, warning = F, echo=F}
#interaction between age & striking accuracy and  takedowns landed
ufc$stance <- as.factor(ufc$stance)

model5 <- lm(win_ratio ~ age + stance + average_takedowns_landed_per_15_minutes + significant_striking_accuracy +
            significant_strikes_landed_per_minute + significant_strikes_absorbed_per_minute + significant_strike_defence + age*average_takedowns_landed_per_15_minutes + age*significant_striking_accuracy + age*significant_strikes_absorbed_per_minute + age*significant_strike_defence, 
            data = ufc)


summary(model5)

```

